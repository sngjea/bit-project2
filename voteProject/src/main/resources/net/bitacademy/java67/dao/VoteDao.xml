<?xml version="1.0" encoding="UTF-8"?>

<!-- 변경 사항: resultMap 적용 -->

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.bitacademy.java67.dao.VoteDao">
  
  <resultMap type="VoteVo" id="VoteVoMap">
    <id     column="VTno"      property="no" />
    <result column="title"    property="title" />
    <result column="content"  property="content" />
    <result column="cre_date" property="createDate" />
    <result column="views"    property="views" />
    <result column="photo1"    property="photo1" />
    <result column="photo2"    property="photo2" />
    <result column="voteCount1"    property="voteCount1" />
    <result column="voteCount2"    property="voteCount2" />
  </resultMap>
  
  <!-- useGeneratedKeys 속성의 값을 true로 설정하면,
    INSERT 할 때 자동 생성된 bno 값을 파라미터 객체에 꺼꾸로 설정해 준다.
   -->
  <insert id="insert" parameterType="VoteVo"
        keyColumn="VTno" keyProperty="no" useGeneratedKeys="true">
      INSERT INTO voteTable (title,photo1,photo2,photoTag1,photoTag2,voteCount1,voteCount2,content,userID,views,category,cre_date) 
      VALUES (#{title},#{photoOne},#{photoTwo},#{photoTag1},#{photoTag2},#{voteCount1},#{voteCount2},#{content},#{userID},#{views},#{category},now())
  </insert>
  
  <select id="selectList" parameterType="map" resultMap="VoteVoMap">
      SELECT bno, title, cre_date, views 
      FROM board2
    <if test="word != null and word != ''">
      WHERE title like CONCAT('%', #{word}, '%') OR
            content like CONCAT('%', #{word}, '%')
    </if>
    <choose>
      <when test="order == 'title'">ORDER BY title ASC</when>
      <when test="order == 'createDate'">ORDER BY cre_date ASC</when>
      <when test="order == 'views'">ORDER BY views DESC</when>
      <otherwise>ORDER BY bno DESC</otherwise>
    </choose>
      LIMIT #{startIndex}, #{pageSize}
  </select>
  
  <select id="countAll" parameterType="string" resultType="int">
      SELECT count(bno)  
      FROM board2
    <if test="value != null and value != ''">
      WHERE title like CONCAT('%', #{value}, '%') OR
            content like CONCAT('%', #{value}, '%')
    </if>
  </select>
  
  <select id="check" parameterType="int" resultType="int">
      SELECT id  
      FROM id where id=#{no}
  </select>
  
  <select id="selectOne" parameterType="int" resultMap="VoteVoMap">
      SELECT bno, title, content, cre_date, views 
      FROM board2 
      WHERE bno=#{no}
  </select>
  
  <delete id="delete" parameterType="int">
      DELETE FROM board2 WHERE bno=#{value}
  </delete>
  
  <update id="update" parameterType="VoteVo">
      UPDATE board2 SET 
        title=#{title} 
        ,content=#{content}
      WHERE bno=#{no}
  </update>
  
</mapper>









